<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrainingApp - MP & PM</title>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;700&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/5820e99692.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="../styles/mainSite.css">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300&display=swap" rel="stylesheet">


    <!-- <script src="../scripts/mymodal.js"></script> -->
    <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-app.js"></script>
    <!-- If you enabled Analytics in your project, add the Firebase SDK for Analytics -->
    <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-analytics.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/8.4.1/firebase-auth.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/8.4.1/firebase-database.js"></script>

    <script src="../scripts/firebase-config.js"></script>



    <script>
        var today;
        var day;
        var month;
        var year;
        var checkDate;

        function Timestamp() {
            var id = new Date();
            id =
                parseInt(id.getMonth() + 1) +
                "" +
                id.getDate() +
                "" +
                id.getFullYear() +
                "" +
                id.getHours() +
                "" +
                id.getMinutes() +
                "" +
                id.getSeconds() +
                "" +
                id.getMilliseconds();
            return id;
        }

        // function saveActualDateToDatabase(){
        //     var saveThisDate;
        //     databaseDay = new Date();
        //     var date = document.getElementById("today");
        //     day=databaseDay.getDate();
        //     month=databaseDay.getMonth()+1;
        //     year=databaseDay.getFullYear();

        //     return saveThisDate = day + "-" + month + "-" + year;
        // }

        function actualdate() {
            var checkDate;
            today = new Date();
            var date = document.getElementById("today");
            day = today.getDate();
            month = today.getMonth() + 1;
            year = today.getFullYear();

            checkDate = year + "-" + month + "-" + day;
            date.innerHTML = day + "-" + month + "-" + year;

            console.log("Czy to działa ?");
            showDayFromDatabase(checkDate);
            showTotalSummary(checkDate);


            today_day = today.getDate();
            today_month = today.getMonth() + 1;
            today_year = today.getFullYear();

            today_data = today_day + "-" + today_month + "-" + today_year;

        }

        function dayBefore() {
            var yesterday = document.getElementById("today");

            if (month == 1) {
                if (day == 1) {
                    month = 12;
                    day = 31;
                    year = year - 1;
                } else {
                    day = day - 1;
                }
            } else if (month == 2) {
                if (day == 1) {
                    month = 1;
                    day = 31;
                } else {
                    day = day - 1;
                }

            } else if (month == 3) {
                if (day == 1) {
                    if (year % 4 == 0) {
                        month = 2;
                        day = 29;
                    } else {
                        month = 2;
                        day = 28;
                    }
                } else {
                    day = day - 1;
                }

            } else if (month == 4) {
                if (day == 1) {
                    month = 3;
                    day = 31;
                } else {
                    day = day - 1;
                }

            } else if (month == 5) {
                if (day == 1) {
                    month = 4;
                    day = 30;
                } else {
                    day = day - 1;
                }

            } else if (month == 6) {
                if (day == 1) {
                    month = 5;
                    day = 31;
                } else {
                    day = day - 1;
                }

            } else if (month == 7) {
                if (day == 1) {
                    month = 6;
                    day = 30;
                } else {
                    day = day - 1;
                }

            } else if (month == 8) {
                if (day == 1) {
                    month = 7;
                    day = 31;
                } else {
                    day = day - 1;
                }

            } else if (month == 9) {
                if (day == 1) {
                    month = 8;
                    day = 31;
                } else {
                    day = day - 1;
                }

            } else if (month == 10) {
                if (day == 1) {
                    month = 9;
                    day = 30;
                } else {
                    day = day - 1;
                }

            } else if (month == 11) {
                if (day == 1) {
                    month = 10;
                    day = 31;
                } else {
                    day = day - 1;
                }

            } else if (month == 12) {
                if (day == 1) {
                    month = 11;
                    day = 30;
                } else {
                    day = day - 1;
                }
            }

            checkDate = year + "-" + month + "-" + day;

            console.log("dayBefore " + checkDate);

            yesterday.innerHTML = day + "-" + month + "-" + year;

            showDayFromDatabase(checkDate);
        }

        function dayAfter() {
            var tomorrow = document.getElementById("today");

            if (month == 1) {
                if (day == 31) {
                    month = 2;
                    day = 1;
                } else {
                    day = day + 1;
                }
            } else if (month == 2) {
                if (year % 4 == 0) {
                    if (day == 29) {
                        month = 3;
                        day = 1;
                    } else {
                        day = day + 1;
                    }
                } else {
                    if (day == 28) {
                        month = 3;
                        day = 1;
                    } else {
                        day = day + 1;
                    }
                }
            } else if (month == 3) {
                if (day == 31) {
                    month = 4;
                    day = 1;
                } else {
                    day = day + 1;
                }

            } else if (month == 4) {
                if (day == 30) {
                    month = 5;
                    day = 1;
                } else {
                    day = day + 1;
                }

            } else if (month == 5) {
                if (day == 31) {
                    month = 6;
                    day = 1;
                } else {
                    day = day + 1;
                }

            } else if (month == 6) {
                if (day == 30) {
                    month = 7;
                    day = 1;
                } else {
                    day = day + 1;
                }

            } else if (month == 7) {
                if (day == 31) {
                    month = 8;
                    day = 1;
                } else {
                    day = day + 1;
                }

            } else if (month == 8) {
                if (day == 31) {
                    month = 9;
                    day = 1;
                } else {
                    day = day + 1;
                }

            } else if (month == 9) {
                if (day == 30) {
                    month = 10;
                    day = 1;
                } else {
                    day = day + 1;
                }

            } else if (month == 10) {
                if (day == 31) {
                    month = 11;
                    day = 1;
                } else {
                    day = day + 1;
                }

            } else if (month == 11) {
                if (day == 30) {
                    month = 12;
                    day = 1;
                } else {
                    day = day + 1;
                }

            } else if (month == 12) {
                if (day == 31) {
                    month = 1;
                    day = 1;
                    year = year + 1;
                } else {
                    day = day + 1;
                }
            }

            checkDate = year + "-" + month + "-" + day;
            console.log(checkDate);
            tomorrow.innerHTML = day + "-" + month + "-" + year;
            showDayFromDatabase(checkDate);
        }

        function showDayFromDatabase(checkDate) {
            console.log("showDayFromDatabase " + checkDate);
            firebase.auth().onAuthStateChanged((user) => {
                if (user) {
                    // User logged in already or has just logged in.
                    user_id = user.uid;
                    const dbRef = firebase.database().ref();
                    dbRef.child("users").child(user_id).child("Date").get().then((snapshot) => {
                        if (snapshot.exists()) {
                            data = Object.keys(snapshot.val());
                            console.log(data);
                            compareDate(data, checkDate);
                            showAllProductsFromDatabase();
                        } else {
                            console.log("No data available");
                        }
                    }).catch((error) => {
                        console.error(error);
                    });
                } else {
                    console.log("uzytkownik niezalogowany");
                }
            });
        }

        function compareDate(data, checkDate) {

            console.log("compareDate " + checkDate);
            console.log(data);

            var database = firebase.database();
            var user = firebase.auth().currentUser;
            var i = 0;
            var visibilityOptions1 = document.getElementById("tableFooter1");
            var visibilityOptions2 = document.getElementById("tableFooter2");
            var visibilityOptions3 = document.getElementById("tableFooter3");
            var visibilityOptions4 = document.getElementById("tableFooter4");

            // console.log("day: " + day + "\n");
            // console.log("month:  " + month + "\n");
            // console.log("year: " + year + "\n");
            // console.log("today_day: " + today_day + "\n");
            // console.log("today_month: " + today_month + "\n");
            // console.log("today_year: " + today_year + "\n");


            if (year < today_year) {
                visibilityOptions1.className = "hidden";
                visibilityOptions2.className = "hidden";
                visibilityOptions3.className = "hidden";
                visibilityOptions4.className = "hidden";
            } else if (today_year < year) {
                visibilityOptions1.className = "visible";
            } else {
                if (month < today_month) {
                    visibilityOptions1.className = "hidden";
                    visibilityOptions2.className = "hidden";
                    visibilityOptions3.className = "hidden";
                    visibilityOptions4.className = "hidden";
                } else if (month > today_month) {
                    visibilityOptions1.className = "visible";
                } else {
                    if (day < today_day) {
                        visibilityOptions1.className = "hidden";
                        visibilityOptions2.className = "hidden";
                        visibilityOptions3.className = "hidden";
                        visibilityOptions4.className = "hidden";
                    } else {
                        visibilityOptions1.className = "visible";
                        visibilityOptions2.className = "visible";
                        visibilityOptions3.className = "visible";
                        visibilityOptions4.className = "visible";
                    }
                }
            }

            data.forEach((ex) => {
                // console.log(data);
                dateInDatabase = data[i];
                // console.log(data[i]);
                if (checkDate == dateInDatabase) {

                    showBreakfast(checkDate);
                    showSecondBreakfast(checkDate);
                    showDinner(checkDate);
                    showSupper(checkDate);
                }
                i++;
            });
        }

        function showAllProductsFromDatabase() {
            var database = firebase.database();
            var user = firebase.auth().currentUser;

            firebase
                .database()
                .ref("/products/")
                .once("value")
                .then((snapshot) => {
                    //console.log(Object.values(snapshot.val()));
                    products = Object.values(snapshot.val());
                    //addItemsToInput(products);
                    showDataInSelect1(products);
                    showDataInSelect2(products);
                    showDataInSelect3(products);
                    showDataInSelect4(products);
                })
                .catch((error) => {
                    console.error(error);
                });
        }

        function showDataInSelect1(data) {
            var database = firebase.database();
            var user = firebase.auth().currentUser;
            let id = Timestamp();
            var table;

            var box = document.getElementById("breakfast1");

            data.forEach((ex) => {
                Name = ex.Name;
                Fat = ex.Fat;
                Carbohydrates = ex.Carbohydrates;
                Proteins = ex.Proteins;
                Id = ex.Id

                var container = document.createElement("option");

                box.appendChild(container);

                var products = document.createElement("span");
                nameProducts = document.createTextNode(ex.Name);
                products.appendChild(nameProducts);
                container.appendChild(products);

                var nutrients = document.createElement("span")
                nutrientsQuantity = document.createTextNode(" - " + ex.Proteins + " - " + ex.Fat + " - " + ex
                    .Carbohydrates);
                nutrients.appendChild(nutrientsQuantity);
                container.appendChild(nutrients);

            });
        }

        function showDataInSelect2(data) {
            var database = firebase.database();
            var user = firebase.auth().currentUser;
            let id = Timestamp();
            var table;

            var box = document.getElementById("secondBreakfast2");

            data.forEach((ex) => {
                Name = ex.Name;
                Fat = ex.Fat;
                Carbohydrates = ex.Carbohydrates;
                Proteins = ex.Proteins;
                Id = ex.Id

                var container = document.createElement("option");

                box.appendChild(container);

                var products = document.createElement("span");
                nameProducts = document.createTextNode(ex.Name);
                products.appendChild(nameProducts);
                container.appendChild(products);

                var nutrients = document.createElement("span")
                nutrientsQuantity = document.createTextNode(" - " + ex.Proteins + " - " + ex.Fat + " - " + ex
                    .Carbohydrates);
                nutrients.appendChild(nutrientsQuantity);
                container.appendChild(nutrients);

            });
        }

        function showDataInSelect3(data) {
            var database = firebase.database();
            var user = firebase.auth().currentUser;
            let id = Timestamp();
            var table;

            var box = document.getElementById("dinner3");

            data.forEach((ex) => {
                Name = ex.Name;
                Fat = ex.Fat;
                Carbohydrates = ex.Carbohydrates;
                Proteins = ex.Proteins;
                Id = ex.Id

                var container = document.createElement("option");

                box.appendChild(container);

                var products = document.createElement("span");
                nameProducts = document.createTextNode(ex.Name);
                products.appendChild(nameProducts);
                container.appendChild(products);

                var nutrients = document.createElement("span")
                nutrientsQuantity = document.createTextNode(" - " + ex.Proteins + " - " + ex.Fat + " - " + ex
                    .Carbohydrates);
                nutrients.appendChild(nutrientsQuantity);
                container.appendChild(nutrients);

            });
        }

        function showDataInSelect4(data) {
            var database = firebase.database();
            var user = firebase.auth().currentUser;
            let id = Timestamp();
            var table;

            var box = document.getElementById("supper4");

            data.forEach((ex) => {
                Name = ex.Name;
                Fat = ex.Fat;
                Carbohydrates = ex.Carbohydrates;
                Proteins = ex.Proteins;
                Id = ex.Id

                // console.log("DUPA DEBUGING");
                // console.log(Name);
                // console.log(ex.Name);

                var container = document.createElement("option");

                box.appendChild(container);

                var products = document.createElement("span");
                nameProducts = document.createTextNode(ex.Name);
                products.appendChild(nameProducts);
                container.appendChild(products);

                var nutrients = document.createElement("span")
                nutrientsQuantity = document.createTextNode(" - " + ex.Proteins + " - " + ex.Fat + " - " + ex
                    .Carbohydrates);
                nutrients.appendChild(nutrientsQuantity);
                container.appendChild(nutrients);

            });
        }

        function showBreakfast(date) {
            var database = firebase.database();
            var user = firebase.auth.currentUser;
            var meals = "breakfast";

            console.log("showBreakfast " + date);
            firebase.auth().onAuthStateChanged((user) => {
                if (user) {
                    user_id = user.uid;
                    const dbRef = firebase.database().ref();
                    dbRef.child("users").child(user_id).child("Date").child(date).child("breakfast").get().then(
                        (snapshot) => {
                            if (snapshot.exists()) {
                                breakfast = Object.values(snapshot.val());
                                addItemsTable(meals, breakfast);
                                // countEatenThings(breakfast)
                            } else {
                                console.log("No data available");
                            }
                        }).catch((error) => {
                        console.error(error);
                    });
                } else {
                    console.log("uzytkownik niezalogowany");
                }
            });
        }

        function showSecondBreakfast(date) {
            var database = firebase.database();
            var user = firebase.auth.currentUser;
            var meals = "secondBreakfast";

            console.log("secondBreakfast " + date);
            firebase.auth().onAuthStateChanged((user) => {
                if (user) {
                    user_id = user.uid;
                    const dbRef = firebase.database().ref();
                    dbRef.child("users").child(user_id).child("Date").child(date).child("secondBreakfast").get()
                        .then((snapshot) => {
                            if (snapshot.exists()) {
                                secondBreakfast = Object.values(snapshot.val());
                                addItemsTable(meals, secondBreakfast);
                                // countEatenThings(secondBreakfast)
                            } else {
                                console.log("No data available");
                            }
                        }).catch((error) => {
                            console.error(error);
                        });
                } else {
                    console.log("uzytkownik niezalogowany");
                }
            });
        }

        function showDinner(date) {
            var database = firebase.database();
            var user = firebase.auth.currentUser;
            var meals = "dinner";

            console.log("dinner " + date);
            firebase.auth().onAuthStateChanged((user) => {
                if (user) {
                    user_id = user.uid;
                    const dbRef = firebase.database().ref();
                    dbRef.child("users").child(user_id).child("Date").child(date).child("dinner").get().then((
                        snapshot) => {
                        if (snapshot.exists()) {
                            dinner = Object.values(snapshot.val());
                            addItemsTable(meals, dinner);
                            // countEatenThings(dinner)
                        } else {
                            console.log("No data available");
                        }
                    }).catch((error) => {
                        console.error(error);
                    });
                } else {
                    console.log("uzytkownik niezalogowany");
                }
            });
        }

        function showSupper(date) {
            var database = firebase.database();
            var user = firebase.auth.currentUser;
            var meals = "supper";

            console.log("supper " + date);
            firebase.auth().onAuthStateChanged((user) => {
                if (user) {
                    user_id = user.uid;
                    const dbRef = firebase.database().ref();
                    dbRef.child("users").child(user_id).child("Date").child(date).child("supper").get().then((
                        snapshot) => {
                        if (snapshot.exists()) {
                            supper = Object.values(snapshot.val());
                            addItemsTable(meals, supper);
                            // countEatenThings(supper)
                        } else {
                            console.log("No data available");
                        }
                    }).catch((error) => {
                        console.error(error);
                    });
                } else {
                    console.log("uzytkownik niezalogowany");
                }
            });
        }

        function dynamicDeleteBefore() {
            var Parent1 = document.getElementById("breakfast");
            var Parent2 = document.getElementById("secondBreakfast");
            var Parent3 = document.getElementById("dinner");
            var Parent4 = document.getElementById("supper");
            var Parent5 = document.getElementById("breakfast1")
            var Parent6 = document.getElementById("secondBreakfast2")
            var Parent7 = document.getElementById("dinner3")
            var Parent8 = document.getElementById("supper4")
            var Parent9 = document.getElementById("demands")


            while (Parent1.hasChildNodes()) {
                Parent1.removeChild(Parent1.firstChild);
            }
            while (Parent2.hasChildNodes()) {
                Parent2.removeChild(Parent2.firstChild);
            }
            while (Parent3.hasChildNodes()) {
                Parent3.removeChild(Parent3.firstChild);
            }
            while (Parent4.hasChildNodes()) {
                Parent4.removeChild(Parent4.firstChild);
            }
            while (Parent5.hasChildNodes()) {
                Parent5.removeChild(Parent5.firstChild);
            }
            while (Parent6.hasChildNodes()) {
                Parent6.removeChild(Parent6.firstChild);
            }
            while (Parent7.hasChildNodes()) {
                Parent7.removeChild(Parent7.firstChild);
            }
            while (Parent8.hasChildNodes()) {
                Parent8.removeChild(Parent8.firstChild);
            }
            while (Parent9.hasChildNodes()) {
                Parent9.removeChild(Parent9.firstChild);
            }
            dayBefore();
        }

        function dynamicDeleteAfter() {
            var Parent1 = document.getElementById("breakfast");
            var Parent2 = document.getElementById("secondBreakfast");
            var Parent3 = document.getElementById("dinner");
            var Parent4 = document.getElementById("supper");
            var Parent5 = document.getElementById("breakfast1")
            var Parent6 = document.getElementById("secondBreakfast2")
            var Parent7 = document.getElementById("dinner3")
            var Parent8 = document.getElementById("supper4")
            var Parent9 = document.getElementById("demands")



            while (Parent1.hasChildNodes()) {
                Parent1.removeChild(Parent1.firstChild);
            }
            while (Parent2.hasChildNodes()) {
                Parent2.removeChild(Parent2.firstChild);
            }
            while (Parent3.hasChildNodes()) {
                Parent3.removeChild(Parent3.firstChild);
            }
            while (Parent4.hasChildNodes()) {
                Parent4.removeChild(Parent4.firstChild);
            }
            while (Parent5.hasChildNodes()) {
                Parent5.removeChild(Parent5.firstChild);
            }
            while (Parent6.hasChildNodes()) {
                Parent6.removeChild(Parent6.firstChild);
            }
            while (Parent7.hasChildNodes()) {
                Parent7.removeChild(Parent7.firstChild);
            }
            while (Parent8.hasChildNodes()) {
                Parent8.removeChild(Parent8.firstChild);
            }
            while (Parent9.hasChildNodes()) {
                Parent9.removeChild(Parent9.firstChild);
            }
            dayAfter();
        }

        function addItemsTable(meals, data) {
            var getTable = document.getElementById(meals);
            var TextForNameRow;
            var TextForProteinsRow;
            var TextForFatRow;
            var TextForCarbohydratesRow;
            var createTr;
            var CreateNameRow;
            var CreateProteinsRow;
            var CreateFatRow;
            var CreateCarbohydratesRow;

            data.forEach((ex) => {
                createTr = document.createElement("TR"); // Create a <li> node
                CreateNameRow = document.createElement("TD");
                CreateProteinsRow = document.createElement("TD");
                CreateFatRow = document.createElement("TD");
                CreateCarbohydratesRow = document.createElement("TD");
                var span = document.createElement("SPAN");

                createTr.setAttribute("id", ex.Id);
                CreateNameRow.setAttribute("id", ex.Name);
                CreateProteinsRow.setAttribute("id", ex.Proteins);
                CreateFatRow.setAttribute("id", ex.Fat);
                CreateCarbohydratesRow.setAttribute("id", ex.Carbohydrates);

                // CreateNameRow.setAttribute("class", "name");
                // CreateProteinsRow.setAttribute("class", "choosedOption");
                // CreateFatRow.setAttribute("class", "choosedOption");
                // CreateCarbohydratesRow.setAttribute("class", "choosedOption");

                TextForNameRow = document.createTextNode(ex.Name);
                TextForProteinsRow = document.createTextNode(ex.Proteins);
                TextForFatRow = document.createTextNode(ex.Fat);
                TextForCarbohydratesRow = document.createTextNode(ex.Carbohydrates);
                var txt = document.createTextNode("\u00D7");

                if (year < today_year) {
                    span.className = "none";
                } else if (year > today_year) {
                    span.className = "close";
                } else {
                    if (month < today_month) {
                        span.className = "none";
                    } else if (month > today_month) {
                        span.className = "close";
                    } else {
                        if (day < today_day) {
                            span.className = "none";
                        } else {
                            span.className = "close";
                        }
                    }
                }

                CreateNameRow.appendChild(TextForNameRow);
                CreateProteinsRow.appendChild(TextForProteinsRow);
                CreateFatRow.appendChild(TextForFatRow);
                CreateCarbohydratesRow.appendChild(TextForCarbohydratesRow);
                span.appendChild(txt);

                createTr.appendChild(CreateNameRow);
                createTr.appendChild(CreateProteinsRow);
                createTr.appendChild(CreateFatRow);
                createTr.appendChild(CreateCarbohydratesRow);
                createTr.appendChild(span)
                getTable.appendChild(createTr);
                deleteToDo(span, ex.Id, meals);
            });
        }

        function addNewProduct(meals, meals2) {
            getAddProductButton = document.querySelector("addNewProduct");
            getTable = document.getElementById(meals);
            getmeals = document.getElementById(meals2);
            // console.log("addNewProduct " + day);
            // console.log("addNewProduct " + month);
            // console.log("addNewProduct " + year);

            actualDay = year + "-" + month + "-" + day;

            // console.log(actualDay);

            var user = firebase.auth().currentUser;
            let id = Timestamp();
            var database = firebase.database();

            choosedOption = getmeals.options[getmeals.selectedIndex].text;
            var str;
            str = choosedOption.split("-");
            var Name = str[0];
            var Proteins = str[1];
            var Fat = str[2];
            var Carbohydrates = str[3];

            createTableR = document.createElement("tr");
            createTableD1 = document.createElement("td");
            createTableD2 = document.createElement("td");
            createTableD3 = document.createElement("td");
            createTableD4 = document.createElement("td");
            var span = document.createElement("SPAN");

            createTableR.setAttribute("id", id)

            sampleProductName = document.createTextNode(str[0]);

            sampleProductMacro1 = document.createTextNode(Proteins);
            sampleProductMacro2 = document.createTextNode(Fat);
            sampleProductMacro3 = document.createTextNode(Carbohydrates);
            var txt = document.createTextNode("\u00D7");
            span.className = "close";

            getTable.appendChild(createTableR);
            createTableR.appendChild(createTableD1);
            createTableR.appendChild(createTableD2);
            createTableR.appendChild(createTableD3);
            createTableR.appendChild(createTableD4);
            createTableR.appendChild(span);

            span.appendChild(txt);
            createTableD1.appendChild(sampleProductName);
            createTableD2.appendChild(sampleProductMacro1);
            createTableD3.appendChild(sampleProductMacro2);
            createTableD4.appendChild(sampleProductMacro3);

            for (i = 0; i < close.length; i++) {
                close[i].onclick = function () {
                    var div = this.parentElement;
                    div.style.display = "none";
                };
            }
            deleteToDo(span, id, meals);



            firebase.auth().onAuthStateChanged((user) => {
                if (user) {
                    // User logged in already or has just logged in.
                    user_id = user.uid;
                    firebase
                        .database()
                        .ref("users/" + user_id + "/Date/" + actualDay + "/" + meals)
                        .update({
                            [id]: {
                                Name: Name,
                                Proteins: Proteins,
                                Fat: Fat,
                                Carbohydrates: Carbohydrates,
                                Id: id,
                            },
                        });
                }
            });

            var database = firebase.database();
            var user = firebase.auth.currentUser;
            var LewoMeals = meals;
            var SummaryFat = 0;
            var SummaryProteins = 0;
            var SummaryCarbohydrates = 0;

            console.log(LewoMeals + actualDay);
            firebase.auth().onAuthStateChanged((user) => {
                if (user) {
                    user_id = user.uid;
                    const dbRef = firebase.database().ref();
                    dbRef.child("users").child(user_id).child("Date").child(actualDay).child(LewoMeals).get()
                        .then((
                            snapshot) => {
                            if (snapshot.exists()) {
                                meealKeys = Object.keys(snapshot.val());
                                meealValues = Object.values(snapshot.val());
                                console.log(meealKeys, meealValues);
                                for (i = 0; i < meealKeys.length; i++) {
                                    tmp = meealValues[i];
                                    SummaryFat += tmp.Fat * 1;
                                    SummaryProteins += tmp.Proteins * 1;
                                    SummaryCarbohydrates += tmp.Carbohydrates * 1;
                                }
                                //console.log(SummaryFat, SummaryProteins, SummaryCarbohydrates);
                                updateSummary(SummaryFat, SummaryProteins, SummaryCarbohydrates, actualDay,
                                    LewoMeals);

                            } else {
                                console.log("No data available");
                            }
                        }).catch((error) => {
                            console.error(error);
                        });
                } else {
                    console.log("uzytkownik niezalogowany");
                }
            });
        }

        function updateSummary(SummaryFat, SummaryProteins, SummaryCarbohydrates, actualDay, meal) {
            firebase.auth().onAuthStateChanged((user) => {
                if (user) {
                    // User logged in already or has just logged in.
                    user_id = user.uid;
                    firebase
                        .database()
                        .ref("users/" + user_id + "/Date/" + actualDay + "/Summary/" + meal)
                        .update({
                            Proteins: SummaryProteins,
                            Fats: SummaryFat,
                            Carbohydrates: SummaryCarbohydrates,
                        });
                }
            });

            tmpTable = ["breakfast", "secondBreakfast", "dinner", "supper"];
            var summary_Fat = 0;
            var summary_Carbs = 0;
            var summary_Proteins = 0;
            tmpTable.forEach((ex) => {
                firebase.auth().onAuthStateChanged((user) => {
                    if (user) {
                        user_id = user.uid;
                        const dbRef = firebase.database().ref();
                        dbRef.child("users").child(user_id).child("Date").child(actualDay).child(
                                "Summary").child(ex)
                            .get().then(
                                (snapshot) => {
                                    if (snapshot.exists()) {
                                        keys = Object.keys(snapshot.val());
                                        values = Object.values(snapshot.val());
                                        summary_Fat += values[0];
                                        summary_Carbs += values[1];
                                        summary_Proteins += values[2];
                                        setTotalSummary(summary_Fat, summary_Carbs, summary_Proteins);

                                    } else {
                                        console.log("No data available");
                                    }
                                }).catch((error) => {
                                console.error(error);
                            });
                    } else {
                        console.log("uzytkownik niezalogowany");
                    }
                });
            });

        }

        function setTotalSummary(summary_Fat, summary_Carbs, summary_Proteins) {
            firebase.auth().onAuthStateChanged((user) => {
                if (user) {
                    // User logged in already or has just logged in.
                    user_id = user.uid;
                    firebase
                        .database()
                        .ref("users/" + user_id + "/Date/" + actualDay + "/totalSummary/")
                        .update({
                            Proteins: summary_Proteins,
                            Fats: summary_Carbs,
                            Carbohydrates: summary_Fat,
                        });
                }
            });
        }

        function showTotalSummary(date) {

            geteatenCarb = document.getElementById("eatenCarb");
            geteatenFat = document.getElementById("eatenFat");
            geteatenProtein = document.getElementById("eatenProtein");

            firebase.auth().onAuthStateChanged((user) => {
                if (user) {
                    user_id = user.uid;
                    const dbRef = firebase.database().ref();
                    dbRef.child("users").child(user_id).child("Date").child(date).child("totalSummary").get()
                        .then((
                            snapshot) => {
                            if (snapshot.exists()) {
                                meealKeys = Object.keys(snapshot.val());
                                meealValues = Object.values(snapshot.val());
                                console.log(meealKeys, meealValues);
                                geteatenCarb.appendChild(document.createTextNode(meealValues[0]));
                                geteatenFat.appendChild(document.createTextNode(meealValues[1]));
                                geteatenProtein.appendChild(document.createTextNode(meealValues[2]));


                            } else {
                                console.log("No data available");
                            }
                        }).catch((error) => {
                            console.error(error);
                        });
                } else {
                    console.log("uzytkownik niezalogowany");
                }
            });
        }

        function deleteToDo(el, id, meals) {

            thisDate = year + "-" + month + "-" + day;

            el.addEventListener("click", (e) => {
                var meals_id = e.target.parentNode.id;
                firebase
                    .database()
                    .ref("users/" + user_id + "/Date/" + thisDate + "/" + meals + "/" + meals_id)
                    .remove()
                    .then(() => {
                        console.log(thisDate);
                        e.target.parentNode.remove();
                    })
                    .catch((error) => {
                        console.error(error);
                    });
            });
        }

        // function countEatenThings(data) {
        //     countEatenProteins  = 0;
        //     countEatenFats = 0;
        //     countEatenCarbs = 0;
        //     console.log(data)

        //     data.forEach((ex) => {
        //         countEatenProteins += ex.Proteins * 1;
        //         countEatenFats += ex.Fat * 1;
        //         countEatenCarbs += ex.Carbohydrates * 1;
        //     });

        //     getEatenProtein = document.getElementsByClassName("eatenProtein");
        //     textForEatenProtein = document.createTextNode(countEatenProteins);
        //     getEatenProtein[0].appendChild(textForEatenProtein);

        //     getEatenFats = document.getElementsByClassName("eatenFat");
        //     textForEatenFat = document.createTextNode(countEatenFats);
        //     getEatenFats[0].appendChild(textForEatenFat);

        //     getEatenCarbs = document.getElementsByClassName("eatenCarb");
        //     textForEatenCarbs = document.createTextNode(countEatenCarbs);
        //     getEatenCarbs[0].appendChild(textForEatenCarbs);
        // }
        function logOut() {
            firebase
                .auth()
                .signOut()
                .then(() => {
                    console.log("User signed out!");
                    window.location.replace("../index.html");
                });
        }
    </script>
</head>

<body onload="actualdate()">
    <div class="background">
        <div class="bg"></div>
        <nav>
            <span class="trainingApp"><a href="mainSite.html">TrainingApp</a></span>
            <span class=navIcon><a href="mainSite.html"><i class="fas fa-utensils"></i></a></span>
            <span class=navIcon><a href="workouts.html"><i class="fas fa-dumbbell"></i></a></span>
            <span class=navIcon><a href="#"><i class="fas fa-calendar-alt"></i></a></span>
            <span class=navIcon>
                <div class="dropdown">
                    <button id="dropbtn" class="fas fa-cogs fa-sm"></button>
                    <div class="dropdown-content">
                        <a href="settings.html"><i class="fas fa-user"></i>Profil</a>
                        <a href="#" onclick="logOut()"><i class="fas fa-sign-out-alt"></i>LOGOUT</a>

                    </div>
                </div>
            </span>
        </nav>
        <div class="content2">
            <button id="dateChanger" class="left" onclick="dynamicDeleteBefore()">
                <img src="../images/left-arrow.png" width="10" height="10" alt="submit" />
            </button>
            <div id="today"></div>
            <button id="dateChanger" class="right" onclick="dynamicDeleteAfter()">
                <img src="../images/right-arrow.png" width="10" height="10" alt="submit" />
            </button>
        </div>
        <main>
            <div id="panelMain" class="row">
                <div id="panelMainContent" class="col-12">
                    <div class="row">
                        <div class="col-5" id="meals">
                            <div class="boxTitle">
                                <table class="table-title">
                                    <tr>
                                        <th>śniadanie</th>
                                        <th>B / T / W</th>
                                    </tr>
                                </table>
                            </div>
                            <div class="boxContent">
                                <table class="table" id="breakfast">
                                </table>
                            </div>
                            <div id="tableFooter1" class="visible">
                                <!-- <div class="boxContent" id="boxContent"></div> -->
                                <select id="breakfast1" name="products">

                                </select>
                                <button class="addNewProduct"
                                    onclick="addNewProduct('breakfast','breakfast1');">Dodaj</button>
                            </div>
                        </div>
                        <div class="col-5" id="meals">
                            <div class="boxTitle">
                                <table class="table-title">
                                    <tr>
                                        <th>II śniadanie</th>
                                        <th>B / T / W</th>
                                    </tr>
                                </table>
                            </div>
                            <div class="boxContent">
                                <table class="table" id="secondBreakfast">
                                </table>
                            </div>
                            <div id="tableFooter2" class="visible">
                                <!-- <div class="boxContent" id="boxContent"></div> -->
                                <select id="secondBreakfast2" name="products">

                                </select>
                                <button class="addNewProduct"
                                    onclick="addNewProduct('secondBreakfast','secondBreakfast2');">Dodaj</button>
                            </div>
                        </div>
                        <div class="col-5" id="meals">
                            <div class="boxTitle">
                                <table class="table-title">
                                    <tr>
                                        <th>obiad</th>
                                        <th>B / T / W</th>
                                    </tr>
                                </table>
                            </div>
                            <div class="boxContent">
                                <table class="table" id="dinner">
                                </table>
                            </div>
                            <div id="tableFooter3" class="visible">
                                <!-- <div class="boxContent" id="boxContent"></div> -->
                                <select id="dinner3" name="products">

                                </select>
                                <button class="addNewProduct"
                                    onclick="addNewProduct('dinner','dinner3');">Dodaj</button>
                            </div>
                        </div>
                        <div class="col-5" id="meals">
                            <div class="boxTitle">
                                <table class="table-title">
                                    <tr>
                                        <th>kolacja</th>
                                        <th>B / T / W</th>
                                    </tr>
                                </table>
                            </div>
                            <div class="boxContent">
                                <table class="table" id="supper">
                                </table>
                            </div>
                            <div id="tableFooter4" class="visible">
                                <!-- <div class="boxContent" id="boxContent"></div> -->
                                <select id="supper4" name="products">
                                </select>
                                <button class="addNewProduct"
                                    onclick="addNewProduct('supper','supper4');">Dodaj</button>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </main>
        <aside>
            <section>
                <table>
                    <tr>
                        <th>Białko</th>
                        <th>Tłuszcze</th>
                        <th>Węglowodany</th>
                    </tr>
                    <tr id="demands">
                        <td id="eatenProtein"></td>
                        <td id="eatenFat"></td>
                        <td id="eatenCarb"></td>
                    </tr>
                </table>
            </section>
        </aside>
    </div>

</body>

</html>